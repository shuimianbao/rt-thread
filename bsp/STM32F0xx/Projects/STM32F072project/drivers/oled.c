#include <rtthread.h>
#include <stdlib.h>
#include "oled.h"
#include "finsh.h"

const unsigned char show1[]=
{
0x00,0x06,0x0A,0xFE,0x0A,0xC6,0x00,0xE0,0x00,0xF0,0x00,0xF8,0x00,0x00,0x00,0x00,
0x00,0x00,0xFE,0x7D,0xBB,0xC7,0xEF,0xEF,0xEF,0xEF,0xEF,0xEF,0xEF,0xC7,0xBB,0x7D,
0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,
0x0C,0xFE,0xFE,0x0C,0x08,0x20,0x60,0xFE,0xFE,0x60,0x20,0x00,0x00,0x00,0x78,0x48,
0xFE,0x82,0xBA,0xBA,0x82,0xBA,0xBA,0x82,0xBA,0xBA,0x82,0xBA,0xBA,0x82,0xFE,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0xFF,
0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFF,0x00,0x00,0xFE,0xFF,0x03,
0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,0xFE,0x00,0x00,0x00,0x00,0xC0,0xC0,
0xC0,0x00,0x00,0x00,0x00,0xFE,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,
0xFF,0xFE,0x00,0x00,0xFE,0xFF,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0x03,0xFF,
0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x0C,
0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0xFF,0xFF,0x00,0x00,0x00,0x00,0xE1,0xE1,
0xE1,0x00,0x00,0x00,0x00,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,
0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1F,0x0F,0x00,0x00,0x0F,0x1F,0x18,
0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1F,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x0F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,
0x1F,0x0F,0x00,0x00,0x0F,0x1F,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1F,
0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xE2,0x92,0x8A,0x86,0x00,0x00,0x7C,0x82,0x82,0x82,0x7C,
0x00,0xFE,0x00,0x82,0x92,0xAA,0xC6,0x00,0x00,0xC0,0xC0,0x00,0x7C,0x82,0x82,0x82,
0x7C,0x00,0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0xC0,0xC0,0x00,0x7C,0x82,0x82,0x82,
0x7C,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x24,0xA4,0x2E,0x24,0xE4,0x24,0x2E,0xA4,0x24,0x00,0x00,0x00,0xF8,0x4A,0x4C,
0x48,0xF8,0x48,0x4C,0x4A,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x20,0x10,0x10,
0x10,0x10,0x20,0xC0,0x00,0x00,0xC0,0x20,0x10,0x10,0x10,0x10,0x20,0xC0,0x00,0x00,
0x00,0x12,0x0A,0x07,0x02,0x7F,0x02,0x07,0x0A,0x12,0x00,0x00,0x00,0x0B,0x0A,0x0A,
0x0A,0x7F,0x0A,0x0A,0x0A,0x0B,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0x20,0x40,0x40,
0x40,0x50,0x20,0x5F,0x80,0x00,0x1F,0x20,0x40,0x40,0x40,0x50,0x20,0x5F,0x80,0x00,
};
const unsigned char show2[]=
{
/*--  调入了一幅图像：D:\程序图片\金马鼎12864.bmp  --*/
/*--  宽度x高度=128x64  --*/
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xE0,0xF8,0xF8,0xF8,0xF0,
0xD0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x20,
0x20,0xE0,0xE0,0xE0,0xE0,0xA0,0x20,0x20,0x20,0x20,0xF0,0xF0,0xF0,0xF0,0x20,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0xF0,0xF0,0xE0,0xA0,
0xA0,0xA0,0xA0,0xF0,0xF0,0xF0,0xF0,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF8,0xF8,0xF8,0xF0,0x10,0x00,0x00,0x00,0x80,
0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
0x20,0x20,0x20,0x20,0x20,0xA0,0xE0,0xE0,0xF0,0x70,0x70,0x60,0x00,0x00,0x00,0x00,
0x00,0x00,0x40,0x40,0x60,0x70,0x30,0x38,0x3C,0x2F,0x2F,0x27,0xE1,0xE0,0xE0,0xE1,
0x23,0x37,0x3F,0x3E,0x3C,0x38,0x38,0x38,0x30,0x10,0x10,0x00,0x00,0x00,0x00,0x00,
0x40,0x7F,0x7F,0x7F,0x5F,0x40,0x40,0x40,0x40,0x78,0x7F,0x7F,0x7F,0x40,0xE0,0xE0,
0xE0,0xE0,0x00,0x00,0x00,0x00,0x00,0xFE,0xFE,0xFE,0xFC,0x3F,0x3F,0xBF,0xBF,0x94,
0x94,0x94,0x94,0xBF,0x3F,0x3F,0x3F,0xFE,0xFE,0xFE,0x04,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0xFF,0x21,0x21,0x21,0xFF,0xFF,0xFF,0xFF,0x21,0x21,0x21,0xFF,0xFF,
0xFF,0xFF,0x01,0x00,0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,0x20,
0x20,0xFE,0xFE,0xFE,0xEF,0x23,0x21,0x20,0x20,0x30,0x30,0x30,0x30,0x20,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x02,0x02,0x0E,0x3E,0x7A,0x7A,0x72,0xFF,0xFF,0xFF,0xFF,
0xE2,0xFA,0x7E,0x3F,0x1F,0x8B,0x83,0x82,0x80,0x80,0x00,0x00,0x04,0x04,0x04,0x04,
0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x44,0xC4,0xC4,0xC6,0x86,0xCE,0xFE,0xFF,0xFF,
0x3F,0x00,0x00,0x00,0x00,0x08,0x08,0xC9,0xF9,0xF9,0x79,0x39,0x09,0xFF,0xFF,0xFF,
0x01,0xFF,0xFF,0xFF,0xFF,0x09,0x09,0xFD,0xFD,0xFD,0x0C,0x00,0x00,0x00,0x00,0x00,
0x0F,0x0F,0x0F,0x0F,0x04,0x04,0x04,0xFF,0xFF,0xFF,0xFF,0x04,0x04,0x04,0x07,0x07,
0x87,0xFF,0xF8,0xF8,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,
0x80,0xFF,0xFF,0xFF,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x00,
0x00,0x00,0x00,0x00,0x02,0x02,0x03,0x03,0x01,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
0x00,0x01,0x01,0x01,0x01,0x00,0x00,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
0x01,0x01,0x01,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
};

void OLED_LowLevel_Init(void)
{
  GPIO_InitTypeDef  GPIO_InitStructure;

  /* OLED_I2C Periph clock enable */
  RCC_APB1PeriphClockCmd(OLED_I2C_CLK, ENABLE);
    
  /* Configure the I2C clock source. The clock is derived from the HSI */
  RCC_I2CCLKConfig(RCC_I2C1CLK_HSI);
  
  /* OLED_I2C_SCL_GPIO_CLK, OLED_I2C_SDA_GPIO_CLK 
       and OLED_I2C_SMBUSALERT_GPIO_CLK Periph clock enable */
  RCC_AHBPeriphClockCmd(OLED_I2C_SCL_GPIO_CLK | OLED_I2C_SDA_GPIO_CLK, ENABLE);
  
  /* Connect PXx to I2C_SCL */
  GPIO_PinAFConfig(OLED_I2C_SCL_GPIO_PORT, OLED_I2C_SCL_SOURCE, OLED_I2C_SCL_AF);

  /* Connect PXx to I2C_SDA */
  GPIO_PinAFConfig(OLED_I2C_SDA_GPIO_PORT, OLED_I2C_SDA_SOURCE, OLED_I2C_SDA_AF); 

    
  /* Configure OLED_I2C pins: SCL */
  GPIO_InitStructure.GPIO_Pin = OLED_I2C_SCL_PIN;
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF;
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_2MHz;
  GPIO_InitStructure.GPIO_OType = GPIO_OType_OD;
  GPIO_InitStructure.GPIO_PuPd  = GPIO_PuPd_NOPULL;
  GPIO_Init(OLED_I2C_SCL_GPIO_PORT, &GPIO_InitStructure);

  /* Configure OLED_I2C pins: SDA */
  GPIO_InitStructure.GPIO_Pin = OLED_I2C_SDA_PIN;
  GPIO_Init(OLED_I2C_SDA_GPIO_PORT, &GPIO_InitStructure);

}
void OLED_Init(void)
{  
  I2C_InitTypeDef  I2C_InitStructure;
  
  OLED_LowLevel_Init();
  
  /* OLED_I2C configuration */
  I2C_InitStructure.I2C_Mode = I2C_Mode_I2C;
  I2C_InitStructure.I2C_AnalogFilter = I2C_AnalogFilter_Enable;
  I2C_InitStructure.I2C_DigitalFilter = 0x00;
  I2C_InitStructure.I2C_OwnAddress1 = 0x00;
  I2C_InitStructure.I2C_Ack = I2C_Ack_Enable;
  I2C_InitStructure.I2C_AcknowledgedAddress = I2C_AcknowledgedAddress_7bit;
  I2C_InitStructure.I2C_Timing = OLED_I2C_TIMING;
  
  /* Apply OLED_I2C configuration after enabling it */
  I2C_Init(OLED_I2C, &I2C_InitStructure);
  
  /* OLED_I2C Peripheral Enable */
  I2C_Cmd(OLED_I2C, ENABLE);
}

void OLED_Write_IIC_Command(uint8_t IIC_Command)
{
   //IIC_Start();
   //Write_IIC_Byte(0x78);            //Slave address,SA0=0
   //Write_IIC_Byte(0x00);			//write command
   //Write_IIC_Byte(IIC_Command); 
   //IIC_Stop();

  I2C_TransferHandling(OLED_I2C, OLED_I2C_ADDR, 2, I2C_AutoEnd_Mode, I2C_Generate_Start_Write);
  while(I2C_GetFlagStatus(OLED_I2C, I2C_ISR_TXIS) == RESET);
  I2C_SendData(OLED_I2C, 0x00); 
  while(I2C_GetFlagStatus(OLED_I2C, I2C_ISR_TXIS) == RESET);
  I2C_SendData(OLED_I2C, IIC_Command);
   
}
/**********************************************
// IIC Write Data
**********************************************/
void OLED_Write_IIC_Data(uint8_t IIC_Data)
{
   //IIC_Start();
   //Write_IIC_Byte(0x78);			
   //Write_IIC_Byte(0x40);			//write data
   //Write_IIC_Byte(IIC_Data);
   //IIC_Stop();
  I2C_TransferHandling(OLED_I2C, OLED_I2C_ADDR, 2, I2C_AutoEnd_Mode, I2C_Generate_Start_Write);
  while(I2C_GetFlagStatus(OLED_I2C, I2C_ISR_TXIS) == RESET);
  I2C_SendData(OLED_I2C, 0x40); 
  while(I2C_GetFlagStatus(OLED_I2C, I2C_ISR_TXIS) == RESET);
  I2C_SendData(OLED_I2C, IIC_Data);
}
void OLED_Initial_LY096BG30(void)
{
	OLED_Write_IIC_Command(0xAE);   //display off
	OLED_Write_IIC_Command(0x20);	//Set Memory Addressing Mode	
	OLED_Write_IIC_Command(0x10);	//00,Horizontal Addressing Mode;01,Vertical Addressing Mode;10,Page Addressing Mode (RESET);11,Invalid
	OLED_Write_IIC_Command(0xb0);	//Set Page Start Address for Page Addressing Mode,0-7
	OLED_Write_IIC_Command(0xc8);	//Set COM Output Scan Direction
	OLED_Write_IIC_Command(0x02);//---set low column address
	OLED_Write_IIC_Command(0x10);//---set high column address
	OLED_Write_IIC_Command(0x40);//--set start line address
	OLED_Write_IIC_Command(0x81);//--set contrast control register
	OLED_Write_IIC_Command(0x7f);
	OLED_Write_IIC_Command(0xa1);//--set segment re-map 0 to 127
	OLED_Write_IIC_Command(0xa6);//--set normal display
	OLED_Write_IIC_Command(0xa8);//--set multiplex ratio(1 to 64)
	OLED_Write_IIC_Command(0x3F);//
	OLED_Write_IIC_Command(0xa4);//0xa4,Output follows RAM content;0xa5,Output ignores RAM content
	OLED_Write_IIC_Command(0xd3);//-set display offset
	OLED_Write_IIC_Command(0x00);//-not offset
	OLED_Write_IIC_Command(0xd5);//--set display clock divide ratio/oscillator frequency
	OLED_Write_IIC_Command(0xf0);//--set divide ratio
	OLED_Write_IIC_Command(0xd9);//--set pre-charge period
	OLED_Write_IIC_Command(0x22); //
	OLED_Write_IIC_Command(0xda);//--set com pins hardware configuration
	OLED_Write_IIC_Command(0x12);
	OLED_Write_IIC_Command(0xdb);//--set vcomh
	OLED_Write_IIC_Command(0x20);//0x20,0.77xVcc
	OLED_Write_IIC_Command(0x8d);//--set DC-DC enable
	OLED_Write_IIC_Command(0x14);//
	OLED_Write_IIC_Command(0xaf);//--turn on oled panel 
}

void OLED_fill_picture(uint8_t fill_Data)
{
	unsigned char m,n;
	for(m=0;m<8;m++)
	{
		OLED_Write_IIC_Command(0xb0+m);		//page0-page1
		OLED_Write_IIC_Command(0x00);		//low column start address
		OLED_Write_IIC_Command(0x10);		//high column start address
		for(n=0;n<128;n++)
			{
				OLED_Write_IIC_Data(fill_Data);
			}
	}
}
void OLED_picture_1(void)
{
  unsigned char x,y;
  unsigned int i=0;
  for(y=0;y<8;y++)
    {
      OLED_Write_IIC_Command(0xb0+y);
      OLED_Write_IIC_Command(0x00);
      OLED_Write_IIC_Command(0x10);
      for(x=0;x<128;x++)
        {
          OLED_Write_IIC_Data(show1[i++]);
        }
    }
}

void OLED_picture_2(void)
{
  unsigned char x,y;
  unsigned int i=0;
  for(y=0;y<8;y++)
    {
      OLED_Write_IIC_Command(0xb0+y);
      OLED_Write_IIC_Command(0x00);
      OLED_Write_IIC_Command(0x10);
      for(x=0;x<128;x++)
        {
          OLED_Write_IIC_Data(show2[i++]);
        }
    }
}

void OLED_thread_entry(void* parameter)
{
	OLED_Init();
	OLED_Initial_LY096BG30();
	//while(1)
	{
        //OLED_fill_picture(0XFF);
        //rt_thread_delay(RT_TICK_PER_SECOND);

        //OLED_fill_picture(0X00);
        //rt_thread_delay(RT_TICK_PER_SECOND);

		OLED_picture_1();
        rt_thread_delay(RT_TICK_PER_SECOND);
		//OLED_picture_2();
        //rt_thread_delay(RT_TICK_PER_SECOND);
	}
}

int oledHS(int argc,  char** argv)
{
    //rt_kprintf("argv[0]:  %s\n",  argv[0]);
	//if  (argc  >  1)
	//	rt_kprintf("argv[1]:  %s\n",  argv[1]);
	/******
	  argv1: 0 Right Horizontal Scroll 
	             1 Left Horizontal Scroll
	  argv2: Define start page address  0-7
	  argv3: Define end page address  0-7
	  argv4: Set time interval between each scroll step in terms of  frame frequency 
	  
	 */
	 uint8_t type, spage,epage,frame_time;
	if(argc > 5)
	{
		rt_kprintf("input argv must less than 4\n");
		return -1;
	}

	type = (uint8_t)atoi(argv[1]);
	if(type > 1)
	{
		rt_kprintf("type must be 0 or 1 \n");
		return -1;
	}

	
	spage = (uint8_t)atoi(argv[2]);
	if(spage >7)
	{
		rt_kprintf("spage must be 0 to 7 \n");
		return -1;
	}
	epage = (uint8_t)atoi(argv[3]);
	if((epage >7) || (epage < spage))
	{
		rt_kprintf("epage must be 0 to 7 and larger or equal to spage\n");
		return -1;
	}
	frame_time = (uint8_t)atoi(argv[4]);
	if(frame_time >7)
	{
		rt_kprintf("frame_time must be 0 to 7 \n");
		return -1;
	}
	rt_kprintf("%d,%d,%d,%d\n",type,spage,epage,frame_time);
	OLED_Write_IIC_Command(0x26|type);
    OLED_Write_IIC_Command(0x00);
    OLED_Write_IIC_Command(spage&0x07);
	OLED_Write_IIC_Command(frame_time&0x07);
	OLED_Write_IIC_Command(epage&0x07);
	OLED_Write_IIC_Command(0x00);
	OLED_Write_IIC_Command(0xff);
	OLED_Write_IIC_Command(0x2f);
    return 0;
}
MSH_CMD_EXPORT(oledHS, Continuous Horizontal Scroll);

int oledstopscroll(int argc,  char** argv)
{
	OLED_Write_IIC_Command(0x2e);
}
MSH_CMD_EXPORT(oledstopscroll, Continuous Horizontal Scroll);

FINSH_FUNCTION_EXPORT_ALIAS(oledstopscroll,  stopS,stop scroll);

